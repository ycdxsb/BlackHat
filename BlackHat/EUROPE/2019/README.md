## BlackHat 2019
### Continental Breakfast

### Blue to Red: Traversing the Spectrum
The rising demand for talent to fill thousands of open roles in the security industry has resulted in one significant consequence: overspecialization. This can hinder someone from thinking about the larger picture of security challenges they face and can sometimes be an obstacle to progress. It’s time to get back to basics: Strong fundamentals in InfoSec and computer science are critical when pivoting from one security challenge to the next. In this talk, Amanda will discuss her non-conventional career path in security --from a forensic technician in government, a malware researcher in the private sector, to an offensive engineer on the red team at Facebook--and how a solid grounding in foundational security skills has been an important thread among each role.It’s important now more than ever to strike the right balance between relying on tooling frameworks and pulling from your security fundamentals. In an industry that evolves at hyper speed, having a strong understanding of the basics, such as computer architecture, code compilation, data structures and algorithms is invaluable --and these skills never have an expiration date.  Another core skill in the toolbox of security fundamentals is an adversarial mindset. The joy of picking things apart and dreaming up out-of-the-box solutions to tackle a thorny problem is a requirement for successful hacking. Amanda will discuss how this is not only essential in red teaming, but in all security roles across the spectrum.
### Break

### Conducting a Successful False Flag Cyber Operation (Blame it on China)
Cyber attribution is hard, really hard.  But luckily for attackers, a new armchair analyst is born every minute.  Given any high profile hack, Captain Attribution™ is sure to show up and tell you how obvious it is that {China|Russia|USA|Israel|Iran|USA} hacked your network.  But how hard is it to conduct a false flag cyber operation?  Turns out it's probably easier than you think.  In this session, we'll examine some keys to a successful false flag operation.  The subject of false flag operations has long been popular, but with a number of recent high profile hacking operations, the idea of false flag cyber operations has become a household term. Nation states are resorting to these attacks as well - Russia was caught red handed trying to blame Lazarus for the Olympic Destroyer attacks.
### Chain of Fools: An Exploration of Certificate Chain Validation Mishaps
Typically, when software needs to perform cryptographic tasks, developers use libraries or APIs that abstract many details away from them. They don't need to fully understand how TLS handshakes work to create a TLS socket, nor do they need to understand the cryptographic primitives used to encrypt SSH traffic when making SSH connections. However, some abstractions are leaky, and a better understanding is required to get things right. One example is validation of certificate chains, which is required when using APIs like Google SafetyNet or Android Protected Confirmation.

Applied cryptography can be hard even when using cryptographic libraries. For example, many cryptographic libraries make it difficult or non-obvious to properly validate certificate chains. Generally speaking, it's not because of defects in the library, but rather the difficulty of designing usable cryptographic APIs and providing clear, unambiguous documentation. There's also a lot of incorrect advice on the internet when it comes to implementing common cryptographic workflows. Advice on validating certificate chains is no exception. Oftentimes, this advice instructs the developer to (unknowingly) add untrusted intermediates as trusted roots when building certificate chains, which breaks the chain of trust. This allows an attacker to provide an otherwise valid certificate chain that chains up to a fake root, which will cause certificate chain validation to succeed when it shouldn't.

In this talk, we explore the implications of poor cryptographic API design, how insecure certificate chain validation implementations can be exploited, and how widespread usage of APIs like Android SafetyNet are in certain verticals. We also propose recommendations for both implementers and cryptographic API authors, like choosing misuse-resistant cryptographic APIs and what to do when faced with misuse-prone cryptographic primitives.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Anise-Chain-Of-Fools-An-Exploration-Of-Certificate-Chain-Validation-Mishaps-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Wednesday/eu-19-Anise-Chain-Of-Fools-An-Exploration-Of-Certificate-Chain-Validation-Mishaps-wp-2.pdf)
### Money Doesn&#39;t Stink - Cybercriminal Business Insight of A New Android Botnet
In mid 2018, we discovered one of the largest reported Android banking botnets known to date, that we named Geost. It was discovered when we saw one of their botmasters logging in into one of their C&C servers while using the insecure proxy network created by the HtBot malware. Computers infected with HtBot create an illegal network of proxies that are sold to customers, and our laboratory had one HtBot instance capturing the traffic. Geost resulted to be a new and very large Android Banking botnet operation targeting Russian citizens with almost 1 million victims, 15 C&C servers, thousands of domains, and thousands of malicious APK applications. This research starts with an analysis of all the OpSec failures that resulted in the discovery of Geost. Thought a treat intelligence process, we were able to know the Geost infrastructure, find domains and APKs related to it. Geost accesses all the SMS data of victims and has a direct connection to the systems of five large European banks. The operation of the botnet also includes traffic redirection and selling, data harvesting and access to premium SMS services. During the analysis, there was a breakthrough when we found a chat log of a cybercriminal entrepreneur group related to the Geost operation. This log exposed 28 people doing business for 8 months, discussing numerous projects and activities of the underground market and giving us a unique insight into how the business operation worked: the human relationships between the cybercriminals, daily routine tasks, motivational issues, money laundering, the decisions taken, and obstacles found. The criminal projects ranged from pay per install, phishing website hosting, and C&C development to malicious APKs and fake games development.This presentation shows the inner relationships of a blackmarket underground attacking group, their daily survival problems, decisions, money and struggles to make a living from malicious activities. How the hierarchy of malware development worked in the Geost botnet operation and the impact on the security of the victims. This work is unique because it shows the attackers communications in a private group and reveals a portion of how the underground cybercriminal business operates in relation with technical details of the malware. For them, operating a botnet was just one more job, and they showed no regrets or concerns about where the money is coming from, nor recognition that they were attacking others. At the end of the day, for them, the money didn't stink.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Garcia-Money-Doesnt-Stink-Cybercriminal-Business-Insight-Of-A-New-Android-Botnet-3.pdf)
### First Contact - Vulnerabilities in Contactless Payments
Introduced in 2007, contactless (NFC) payments have been used widely for a decade. Accounting for more than 40% of transactions globally, contactless payments are fast replacing cash and CHIP. Yet, contactless makes use of protocols much older than the technology itself. So, how safe and secure are contactless payments? In this talk, we discuss how the EMV protocols and magstripe modes used for contactless are equally flawed. For the first time, we show how to bypass the UK £30 limit for contactless payments made using physical cards. Then how to circumvent limits for mobile wallets using locked mobile phones. What's more, we cover flaws in the generation keys values, the unpredictable number (UN) and application transaction counter (ATC). Another first, we perform a pre-play attack using EMV without downgrading to legacy modes.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Galloway-First-Contact-Vulnerabilities-In-Contactless-Payments-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Wednesday/eu-19-Galloway-First-Contact-Vulnerabilities-In-Contactless-Payments-wp.pdf)
### Coffee Service

### BluePill: Neutralizing Anti-Analysis Behavior in Malware Dissection
In the malware realm designing transparent sandboxes is only one part of the story. When analysts intervene to understand structure and functional capabilities of complex samples, a good deal of their time is wasted in disarming piles of anti-analysis techniques.To neutralize a slew of new and old tricks in this talk, I present BluePill, a dynamic analysis framework that fools a sample into believing it is executing loosely while being instead under the scalpel of an analyst. Unlike recent proposals, BluePill can operate alongside classic tools from an analyst's arsenal, hiding their presence to the sample.BluePill hooks evasive queries and adversarial sequences (like environment fingerprinting attempts and anti-debugging patterns) altering what the sample sees of the system. It also fast-forwards time to address time-based evasions and stalling strategies. Analysts can debug a sample via GDB remote protocol and benefit from a new technique that hides performed code edits from anti-tampering schemes. Finally, BluePill offers taint tracking capabilities useful to dissect behaviors such as evasions.Designed around analysts, BluePill lets them customize its hooks and add new ones using insight from the dissection, which is especially useful for targeted malware and new tricks. Also, it is immune from semantic gaps. In this talk, I will show how BluePill can defeat tricks from recent evasive samples and executable protectors, making it possible to dissect them on a standard VirtualBox installation alongside classic analysis tools.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Delia-BluePill-Neutralizing-Anti-Analysis-Behavior-In-Malware-Dissection.pdf)
### Mobile Network Hacking, IP Edition
Mobile networks have gone through a decade of security improvements ranging from better GSM encryption to stronger SIM card and SS7 configurations. These improvements were driven by research at this and other hacking conferences. 

Meanwhile, the networks have also mushroomed in complexity by integrating an ever-growing number of IT technologies from SIP to WiFi, IPSec, and most notably web technologies.

This talk illustrates the security shortcomings when merging IT protocols into mobile networks. We bring back hacking gadgets long thought to be mitigated, including intercepting IMSI catchers, remote SMS intercept, and universal caller ID spoofing.

We explore which protection measures are missing from the mobile network and discuss how to best bring them over from the IT security domain into mobile networks.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Yazdanmehr-Mobile-Network-Hacking-IP-Edition-2.pdf)
### Doors of Durin: The Veiled Gate to Siemens S7 Silicon
Siemens is a leading provider of industrial automation components for critical infrastructures, and their S7 PLC series is one of the most widely used PLCs in the industry. In recent years, Siemens integrated various security measures into their PLCs. This includes, among others, firmware integrity verification at boot time using a separate bootloader code. This code is baked in a separated SPI flash, and its firmware is not accessible via Siemens' website. In this talk, we present our investigation of the code running in the Siemens S7-1200 PLC bootloader and its security implications. Specifically, we will demonstrate that this bootloader, which to the best of our knowledge was running at least on Siemens S7-1200 PLCs since 2013, contains an undocumented "special access feature". This special access feature can be activated when the user sends a specific command via UART within the first half-second of the PLC booting. The special access feature provides functionalities such as limited read and writes to memory at boot time via the UART interface. We discovered that a combination of those protocol features could be exploited to execute arbitrary code in the PLC and dump the entire PLC memory using a cold-boot style attack. With that, this feature can be used to violate the existing security ecosystem established by Siemens. On a positive note, once discovered by the asset owner, this feature can also be used for good, e.g., as a forensic interface for Siemens PLCs. The talk will be accompanied by the demo of our findings.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Abbasi-Doors-Of-Durin-The-Veiled-Gate-To-Siemens-S7-Silicon.pdf)
### Exploiting Windows Hello for Business
In Windows 10 and Windows Server 2016, Microsoft has introduced a new feature called Windows Hello for Business (WHfB), that allows password-less authentication in Active Directory-based environments and thus aims to reduce the risk of password theft. It is built on top of well-known industry standards, including Kerberos PKINIT, JWT, WS-Trust or FIDO2 and relies heavily on advanced cryptographic mechanisms like TPM key attestation or token binding. Unfortunately, WHfB is overly complicated, lacks proper management tools and its documentation is missing many important technical details. It is, therefore, a black box for most administrators, security auditors, and pentesters.

While analyzing the current WHfB implementation in Windows, we have identified several new attack vectors that might lead to privilege escalation and persistence. Our most important discovery is a new type of persistent Active Directory backdoor that, to our knowledge, is not detected by current security solutions and audit procedures. Moreover, even companies that do not actively use WHfB might be affected by this threat.

We have also discovered that following Microsoft's mitigation guide for a previously known vulnerability would not only leave Active Directory vulnerable, but it could also introduce yet another security issue into the system. These practically exploitable vulnerabilities might result in Active Directory user impersonation without requiring any special Active Directory permissions.

During this talk, we will also demonstrate our new toolset that can be used to scan corporate environments for the aforementioned vulnerabilities and to resolve any issues found. It also provides a much-required visibility into Windows Hello for Business usage in Active Directory.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Grafnetter-Exploiting-Windows-Hello-for-Business-2.pdf)
### Lunch Break

### Sneak into Your Room: Security Holes in the Integration and Management of Messaging Protocols on Commercial IoT Clouds
With the increasing popularity of the Internet of Things (IoT), many IoT clouds have emerged to help device manufacturers connect their devices to customers and offload the communication management to cloud providers. At the center of such IoT cloud services is the mechanism that mediates the communication (e.g., control commands and messages) between IoT devices and users. Such communication is built on existing general messaging protocols, in particular, MQTT, arguably the most popular one and widely used by mainstream IoT cloud providers such as AWS, Microsoft, IBM, Google, Alibaba, etc. Less clear, however, is whether such protocols, which are not designed to work in the adversarial environment of IoT, introduce new security risks. In this presentation, we report the first systematic study on the protection that leading commercial IoT clouds (e.g., AWS IoT Core, IBM Watson IoT, Azure IoT, Google Cloud IoT, Alibaba IoT, Tuya Smart) put in place for integrating MQTT to device-user communication. We found that in the absence of rigorous security analysis, these platforms' security additions (e.g., authentication, authorization, session management, etc.) to the protocol are all vulnerable, allowing the adversary to gain control of the device, launch a large-scale denial-of-service attack, steal the victim's secret data and fake the victim's device status for deception. We successfully performed proof-of-concept (PoC), end-to-end attacks on eight leading IoT clouds using real commercial IoT devices. We further conducted a measurement study, which demonstrates that the security impacts of our attacks are real, severe and broad. We reported our findings to all affected cloud providers and device manufacturers, which all acknowledged the problems (evidenced by Microsoft's Security Researcher Acknowledgments, CVE-2018-12546, and vendor responses in our supporting site). We also reported our findings to the MQTT Technical Committee (OASIS Open Issues MQTT-536), and the possible mitigations are under open discussion now. In conclusion, our research reveals that in the absence of standard guidance and security practices for integrating and managing the general messaging protocol on IoT clouds, secure user-device interactions cannot be guaranteed in practice, due to the underestimated security gap between the protocol and real-world IoT environments.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Jia-Sneak-Into-Your-Room-Security-Holes-In-The-Integration-And-Management-Of-Messaging-Protocols-On-Commercial-IoT-Clouds-2.pdf)
### Hackers, Journalists and the Ethical Swamp
As hacking stories have increasingly made news headlines, those behind the attacks have become ever more adept at co-opting the media into covering their leaks. From Ashley Madison and Sony to the 2016 US Presidential election, news coverage of cyber attacks has become increasingly weaponized by those behind them. Hacking groups have in some cases made direct contact with journalists to steer them towards a particular story, and in other cases have carefully triaged and strategically leaked the data for maximum impact. This has left journalists in a difficult position: exposing the source of the information could well be unethical, but keeping them anonymous could result in the journalist being manipulated to achieve the aims of a hidden and malign actor who escapes culpability.For hackers wishing to expose government or corporate malpractice, it raises practical issues about how to approach and work with news outlets and their staff; both in terms of security and anonymity, but also the ethics of the eventual news coverage that results. Handing information over to a journalist may mean handing over control of how it's used.In this talk, investigative journalist Geoff White (who has covered technology for, among others, BBC News, Channel 4 News and Forbes) takes five high-profile hacking incidents and analyses how they reflect key trends and tactics for working with (and some cases manipulating) the news media.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-White-Hackers-Journalists-And-The-Ethical-Swamp.pdf)
### Far Sides of Java Remote Protocols
Java Remote Method Invocation (RMI) and Common Object Request Broker Architecture (CORBA) are widely deployed mechanisms for cross-process communications. In this talk, we will walk through the technical workflow of the technologies, revealing several critical flaws under the hood and showing how vendors are failing at securing their implementations of them.There are a number of previous works on the subject but we believe they have yet to capture the extend of their exploitability. We will disclose known, not widely known, and unknown exploitation techniques with overlooked 1-days and 0-days to present fruitful attack surfaces on the protocols' implementation. This will be demonstrated via a number of pre-authentication, remote Code Execution exploits on products of some of the biggest vendors out there.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-An-Far-Sides-Of-Java-Remote-Protocols.pdf)
### HTTP Desync Attacks: Request Smuggling Reborn
HTTP requests are traditionally viewed as isolated, standalone entities. In this session, I'll introduce techniques for remote, unauthenticated attackers to smash through this isolation and splice their requests into others, through which I was able to play puppeteer with the web infrastructure of numerous commercial and military systems, rain exploits on their visitors, and harvest over $70k in bug bounties.Using these targets as case studies, I'll show you how to delicately amend victim's requests to route them into malicious territory, invoke harmful responses, and lure credentials into your open arms. I'll also demonstrate using backend reassembly on your own requests to exploit every modicum of trust placed on the frontend, gain maximum privilege access to internal APIs, poison web caches, and compromise PayPal's login page.HTTP Request Smuggling was first documented back in 2005, but a fearsome reputation for difficulty and collateral damage left it mostly ignored for years while the web's susceptibility grew. Alongside new attack variants and exploitation vectors, I'll help you tackle this legacy with custom open source tooling and a refined methodology for reliable black-box detection, assessment and exploitation with minimal risk of collateral damage. Finally, I'll take a critical look at various significant developments that occurred after this presentation was first delivered at Black Hat USA earlier this year.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Kettle-HTTP-Desync-Attacks-Request-Smuggling-Reborn.pdf)
- [whitepaper](https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn )
- [source_code](https://github.com/PortSwigger/http-request-smuggler)
### Coffee Service

### Reverse Engineering and Exploiting Builds in the Cloud
Continuous Integration, Delivery, and Deployment (CI/CD) and Containers are common terms in today’s IT landscapes and core approaches for modern software development and operation. We will give a short, to-the-point introduction of CI/CD with regard to building containers for hackers, auditors, and everyone involved in the SDLC process. Based on this understanding, we will describe and demo various security pitfalls of multi-tenant cloud build environments which provide Container based build environments. The demos presented are based on real-world examples that were identified during the assessment of various Cloud container build systems. Several new and lesser-known attack vectors and their associated remediations will be covered.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Stalmans-Reverse-Engineering-And-Exploiting-Builds-In-The-Cloud-2.pdf)
### Advanced VBA Macros Attack & Defence
In 2019, VBA macros are still heavily used to deliver malware, and new obfuscation techniques such as VBA Stomping implemented in EvilClippy allow attackers to deliver malicious payloads to end users without being detected. Luckily, analysis and detection tools are also progressing to address all the advanced attack techniques. This presentation will demonstrate some of the advanced attack techniques, and show how analysis and detection tools such as olevba have been recently improved to address the new challenges.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Lagadec-Advanced-VBA-Macros-Attack-And-Defence-2.pdf)
### Is Your Mental Health for Sale?
According to the WHO, 25% of the European population suffer from depression or anxiety each year and depression accounts for up to 50% of chronic sick leaves. This means that every day, millions of people are looking for information about depression online - whether they are seeking help, support or trying to understand how best to support friends and family. At the same time, the current Internet business model heavily relies on targeted advertisement to generate money, tracking people around the web and syphoning their personal data to build accurate profile for the sole (official) purpose of showing you "better ads". See where all of this might go wrong?Considering the sensitive aspect of the mental health-related websites it would seem reasonable to expect that the number and nature of the third parties they include is limited to the viable minimum. Unfortunately, Privacy International's research proved that to be quite wrong. Based on an analysis of 136 popular depression-related websites in France, Germany, and the UK, we observed that a vast majority of these websites embed an impressive number of trackers, mostly for marketing purposes. You might hope that these trackers are at least enabling non-targeted advertisement, yet more than a quarter of the webpages scanned embed third parties who engage in programmatic advertising and Real Time Bidding (RTB). More concerning even, a small subset of these websites offer depression tests that share your answers and results directly or indirectly with third parties.In this talk, we will highlight what type of third parties can be found on mental health-related websites, how frequently some trackers can be found, and what type of tracking they enable. We will then take you on a journey to see exactly what data is being shared with some of these third parties when you take a depression test, from RTB pre-bid requests to the answers you give.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Bendinelli-Is-Your-Mental-Health-For-Sale.pdf)
### Hands Off and Putting SLAB/SLUB Feng Shui in a Blackbox
Successful exploitation against a Linux kernel vulnerability requires the manipulation of memory layout. Over the past years, security researchers have already invented and summarized various memory layout manipulation mechanisms. However, it is still challenging for an attacker to use these manipulation mechanisms to perform exploitation in the real world. This is mainly because an adversary lacks the following knowledge -- (1) which system calls to use to allocate an object of interest and (2) how to systematically adjust system calls to obtain the desired memory layout.

In order to perform exploitation, an adversary needs to select memory layout manipulation approaches and then place the corresponding object. Take an out-of-bounds (OOB) vulnerability for example. In order to hijack the control flow, one should overwrite the critical data in the adjacent object. However, it is common that the adjacent object may not contain critical data such as function or object pointers. Therefore, the most common operation for an adversary is to allocate an appropriate object to the corresponding location prior to the trigger of that vulnerability. For this particular example, it should be an object with a pointer placed at the position adjacent to the vulnerable object. In addition, the adversary has to ensure the OOB vulnerability gives him the freedom to overwrite the data at the address corresponding to the target pointer. 

In the Linux kernel, SLUB/SLAB allocator manages and groups data objects based on their types and sizes. Only the data objects sharing the same type and similar sizes could be placed in the same slab. As a result, when selecting appropriate objects for memory layout manipulation, an adversary has to take the vulnerable object into consideration and select only those objects that could be placed on the same slab. 

According to our measurement, the Linux kernel has thousands of distinct data objects with various sizes and types. In order to allocate them to the slab, an adversary has to utilize corresponding system calls. Unfortunately, given a target object that could be potentially helpful for obtaining control over the program counter, it is generally difficult for the adversary to identify the corresponding system call to allocate that target object. Presumably as such, many vulnerabilities have not yet demonstrated their exploitability publicly. And, the lack of knowledge about system calls also leads adversaries to repeatedly employ the same data objects to perform exploitation. According to recent studies, this repeated data object usage facilitates security analysts to build intrusion signatures and thus ease their identification for the potential intrusion. 

In fact, even if an adversary tracks down the system calls for a particular object, it is still difficult for him to obtain the desired memory layout. This is because, when allocating the target object, in addition to the object of interest, the system calls identified also allocate or deallocate other kernel objects, resulting in unexpected variation in memory layout. Take the aforementioned OOB case for example again. The OOB vulnerability provides an adversary with the ability to overwrite critical data in its neighbor object. Using a set of system calls, an adversary could allocate a victim object containing a function or object pointer on the target slab. However, along with the allocation of the victim object, the system calls at the first place might allocate irrelevant kernel objects, which makes the victim object turn out to be at an unexpected spot. When this situation occurs, adversaries typically look for alternative system calls or adjust memory layout in an ad-hoc manner. In practice, it is not guaranteed to find a memory layout through these two approaches. As a result, the side effect involved by system calls further reduces the number of system calls available and even jeopardizes the exploitability of that vulnerability.

In this talk, we will introduce a precise automated memory layout manipulation technique. We will demonstrate that using this manipulation technique, an attacker could not only easily identify the system calls tied to the objects of interest but, more importantly, automatically assemble system calls to adjust memory layout and thus obtain the desired memory layout useful for exploitation. Different from existing automated memory layout manipulation techniques, our technique does not use a large corpus of testing cases to search the memory layout desired. Rather, it first leverages a static analysis technique to identify all the system calls potentially helpful for object allocation and free. Then, it utilizes the system calls as prior knowledge to allocate and deallocate objects on the slab and thus obtain the memory layout useful for exploitation. In the process of memory layout manipulation, our technique is guided by an algorithm. Along with this talk, we will specify how we design this algorithm and showcase how it automates memory layout manipulation. Along with this talk, we will also release various working exploits against 30+ latest kernel vulnerabilities. These exploits are designed through our memory layout manipulation technique. For the ease of reviewers to assess of our talk, we have uploaded some exploits at https://www.dropbox.com/sh/2kwcwqb8rjro80j/AAC8QBCIhcCylNUDLUd1OZCZa?dl=0
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Chen-Hands-Off-And-Putting-SLAB-SLUB-Feng-Shui-In-A-Blackbox.pdf)
### Break

### Booting the iOS Kernel to an Interactive Bash Shell on QEMU
Booting the iOS kernel on QEMU with an interactive bash shell and a live debugger attached to the kernel. A major step forward in the direction of having a full iOS open source system emulator on QEMU. The research details and demo will be presented in this talk.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Afek-Booting-The-iOS-Kernel-To-An-Interactive-Bash-Shell-On-QEMU.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Wednesday/eu-19-Afek-Booting-The-iOS-Kernel-To-An-Interactive-Bash-Shell-On-QEMU-wp.pdf)
### Fuzzing and Exploiting Virtual Channels in Microsoft Remote Desktop Protocol for Fun and Profit
The Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft, allowing users to remotely control Windows systems with a graphical user interface (GUI) over the network. This protocol is frequently used by IT admins as well as non-technical users for accessing the machine remotely or managing Hyper-V guests VMs from the host machine, via an RDP client. Due to its widespread use, Microsoft's RDP client is shipped with the most of Windows operating systems by default (XP and onwards) and also available in many other platforms including Linux, MacOS, iOS, and Android.

In this talk, we share our adventure in applying coverage-based fuzzing to the RDP client, more specifically, virtual channels in RDP. In the RDP client, virtual channels deal with complex functionalities of RDP such as Sound, Graphics (GDI and RemoteFX), USB, Filesystem, SmartCard, etc., most of which involves parsing and allocation of dynamic data. Based on this fact, we set our main fuzzing targets as virtual channels with a hope of finding numerous crashes.

To achieve this, we first analyze the binary of Microsoft's official RDP client (mstsc.exe) to understand how virtual channels and the RDP server-client operate over the protocol. Then, we tame WinAFL to match the requirements of these model for efficiently fuzz virtual channels backed with code-coverage feedback. As a result, we discovered many exploitable crashes and achieved remote code execution (RCE) in Windows client by exploiting bugs that we found.

In addition to sharing the construction of the fuzzer and demonstrating the exploitation, we will also discuss heap memory management technique, namely, RDP Heap Feng Shui, which is a prerequisite for exploiting heap overflow vulnerability in the RDP client.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Park-Fuzzing-And-Exploiting-Virtual-Channels-In-Microsoft-Remote-Desktop-Protocol-For-Fun-And-Profit-4.pdf)
### ClusterFuzz: Fuzzing at Google Scale
Fuzzing is an effective way of finding security vulnerabilities, but it does not scale well for a defender trying to protect a complex software with several third-party dependencies. There are numerous daunting challenges that come into play which include writing the fuzz targets manually, determining tools and technologies to integrate with, managing continuous fuzzing of these targets at scale, precise crash deduplication, and finally getting the vulnerabilities fixed.

This talk is about how we overcame these challenges to operate the largest publicly known fuzzing infrastructure, running over 25,000 cores, 2,500 targets and find over 8,000 security vulnerabilities in several Google products and 200 open source projects (as part of the free OSS-Fuzz service).

We will dive deeper into how our infrastructure ClusterFuzz completely automates the entire fuzzing lifecycle and how we scale the process of writing fuzz targets into developer workflows. Our experience highlights that these methodologies scale well for both large projects (like Chrome) and small projects (like openssl, libxml, and many other OSS-Fuzz projects).
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Arya-ClusterFuzz-Fuzzing-At-Google-Scale.pdf)
### Bring Your Own Token (BYOT) to Replace the Traditional Smartcards for Strong Authentication and Signing
Smartcards are a good way to enable strong authentication to enterprise network and applications as they provide identification, authentication, and ability to store cryptographic key information on the card using the embedded microchip and memory. The enterprises can provision the smartcards with a digital identity, in the form of a X509 certificate uniquely associated to a user, to enable smartcard logon to servers and Mutual TLS Authentication to services. Traditionally, hybrid cards that provides both the proximity card and smartcard functionalities are used for this purpose, so that the users can have a single card for both facility access as well as strong authentication to IT servers/applications.

There are some limitations and challenges with using the single card as both proximity and smartcard. The proximity cards can generally pre-provisioned in bulk as the association of the user identity to the proximity id can be done after the card is assigned to a user. But for the smartcard, the X509 certificates provisioned to the smartcards contain the user information that must be known at provisioning time. This slows down the provisioning process. There are also other challenges related to issuing replacement/temporary cards for lost or misplaced cards.

This whitepaper describes the solution implemented at Cisco, to replace the traditional hybrid smartcards with Bring Your Own Token (BYOT) model, to overcome the limitations and challenges with the traditional smartcard solutions. The solution enables users to bring their own USB tokens that are compatible with Personal Identity Verification (PIV) and Chip Card Interface Device (CCID) standards, to self-provision the digital identities needed to enable strong authentication, signing and other cryptographic functions.
- [slide](http://i.blackhat.com/eu-19/Wednesday/eu-19-Ramasamy-Bring-Your-Own-Token-To-Replace-The-Traditional-Smartcards-For-Strong-Authentication-And-Signing-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Wednesday/eu-19-Ramasamy-Bring-Your-Own-Token-To-Replace-The-Traditional-Smartcards-For-Strong-Authentication-And-Signing-wp-2.pdf)
### Business Hall Welcome Reception

### Continental Breakfast

### Side Channel Attacks in 4G and 5G Cellular Networks
The adoption of Fourth Generation Long Term Evolution (4G LTE)—the de facto standard for cellular telecommunication—has seen a stable growth in recent years, replacing prior generations due to its promise of improved assurances (e.g., higher bandwidth, reliable connectivity, enhanced security). On top of that, the imminent deployment of the Fifth Generation (5G) cellular network has created much enthusiasm in both industry and academia particularly due to its promise of enabling new applications such as smart vehicles and remote robotic surgery. It is, therefore, expected that 5G rollout will positively impact us from national to a more personal level by enabling applications that often improve our quality of life.

Paging is one of the many important protocols in cellular networks which enables a cellular device- not actively communicating with a base station- to respond to a phone call or an SMS, or any incoming messages for the device. The cellular paging (broadcast) protocol strives to balance between a cellular device's energy consumption and quality-of-service by allowing the device to only periodically poll for pending services in its idle, low-power state. For a given cellular device and serving network, the exact time periods when the device polls for services (called the paging occasion) are fixed by design in the 4G/5G cellular protocol. 

This talk first presents how the fixed nature of paging occasions can be exploited as a side-channel by an adversary in the vicinity of a victim to associate the victim's soft-identity (e.g., phone number, Twitter handle) with its paging occasion, with only a modest cost, through an attack dubbed ToRPEDO (TRacking via Paging mEssage DistributiOn). Consequently, we demonstrate how ToRPEDO can enable an adversary to verify a victim's coarse-grained location information, inject fabricated paging messages, and mount denial-of-service attacks. 

We also demonstrate that, in 4G and 5G, it is plausible for an adversary to retrieve a victim device's persistent identity (i.e., IMSI) with a brute-force "IMSI−Cracking" attack while using ToRPEDO as an attack sub-step. Our further investigation on 4G paging protocol deployments also identified an implementation oversight of several network providers which enables the adversary to launch a new kind of IMSI-Catching attack, named PIERCER (Persistent Information ExposuRe by the CorE netwoRk), for associating a victim's phone number with its IMSI; subsequently allowing targeted user location tracking. All of our attacks have been validated and evaluated in network operators of many different counties including US, Canada, Europe, and South-East Aisa using commodity hardware and software. 

Finally, this talk discusses the potential flaws of the proposed fixes by the Third Generation Partnership Project (3GPP), the standard body for the cellular networks and thus concludes with a direction of potential countermeasures against the presented attacks.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Hussain-Side-Channel-Attacks-In-4G-And-5G-Cellular-Networks.pdf)
### Unleashing the Power of My 20+ Years Old Car
When I came to Japan about a year and half ago, the first thing I did was buy a car. Coming from a ~70hp family car, I chose to go for something more powerful and bought a 90's sports car. I've been dailying it and tracking it since then (> 50 000km so far) and it has been a great car. However, regulations in Japan require manufacturers to add a speed limiter to their cars, preventing you from going over 180km/h (approximatively). In this talk, I will give a brief introduction on how I managed to bypass that limiter, how I could have done it, how I ended up doing it, and what I discovered along the way.Automotive engine computer management will be introduced, as well as a bit of hardware, software reverse engineering, and video demonstrations.This work was done for educational purposes. Testing has been done legally on racetracks and closed roads only.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Lejay-Unleashing-The-Power-Of-My-20-Years-Old-Car.pdf)
### Understanding the IoT Threat Landscape and a Home Appliance Manufacturer&#39;s Approach to Counter Threats to IoT
As we live in a world where billions of IoT devices are connected to the Internet, there are streams of news articles that depict damages caused by malware and other threats that target such devices. While there are some things that users can do to prevent such damages, consumers expect manufacturers to consider security as part of the product design in the development lifecycle.Panasonic, being a device manufacturer, is able to collect information on these threats by connecting our own devices in the development / pre-shipment phases to a honeypot that we have developed. Since its deployment, Panasonic has been able to find 179 million attack cases and 25 thousand malware samples, of which 4,800 were unique samples targeting IoT. 20% of the samples were new and hashes for them did not exist when querying Virustotal. In addition, we discovered 0-day attacks against the SMB protocol, allowing attackers to access data on compromised home appliances.We have developed a system where information being collected through the honeypot is sent to a Sandbox for automated analysis, to address our concern for having a limited number of security experts. What this system allows Panasonic to do is collect "malware targeting/exploiting Panasonic IoT devices" for quicker remediation, in addition to "popular malware" targeting a wide-range of IoT devices.In this session, we will discuss the details of this project and share some analysis of malware that have been collected. By leveraging this information, Panasonic aims to develop products that are resilient to malware. In addition, we are looking for ways to use this threat and remediation information to develop an IoT SOC.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Lin-Understanding-The-IoT-Threat-Landscape-And-A-Home-Appliance-Manufactures-Approach-To-Counter-Threats-To-IoT-2.pdf)
### Detecting (un)Intentionally Hidden Injected Code by Examining Page Table Entries
Malware utilizes code injection techniques to either manipulate other processes (e.g. done by banking trojans) or hide its existence. With some exceptions, such as ROP gadgets, the injected code needs to be executable by the CPU (at least at some point in time).In this talk, we will cover hiding techniques that prevent executable pages (containing injected code) from being reported by current memory forensic plugins. These techniques can either be implemented by malware in order to hide its injected code (as already observed) or can, in one case, unintentionally be taken care of by the operating system through its paging mechanism. In a second step, we present an approach to reveal such pages despite the mentioned hiding techniques by examining Page Table Entries. This approach has been implemented as a plugin for the memory forensic framework Rekall, which automatically reports any memory region containing executable pages.The talk will also contain several live demonstrations, showing the successful hiding from current memory forensic plugins and the detection with our plugin.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Block-Detecting-Un-Intentionally-Hidden-Injected-Code-By-Examining-Page-Table-Entries.pdf)
### Break

### How to Break PDF Encryption
PDF is among the most widely used document formats worldwide. To ensure confidentiality, PDF supports document encryption. In this talk, we analyze PDF encryption and show two novel techniques for breaking the confidentiality of encrypted documents. First, we abuse the PDF feature of partially encrypted documents to wrap the encrypted part of the document within attacker-controlled content and therefore, exfiltrate the plaintext once the document is opened by a legitimate user. Second, we abuse a flaw in the PDF encryption specification to arbitrarily manipulate encrypted content. The only requirement is one single block of known plaintext, which we show is fulfilled by design. Our attacks allow the recovery of the entire plaintext of encrypted documents by using exfiltration channels, based on standard compliant PDF properties.

We evaluated our attacks on 27 widely used PDF viewers and found all of them to be vulnerable. We responsibly disclosed the vulnerabilities and supported the vendors mitigating the issues.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Muller-How-To-Break-PDF-Encryption-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Thursday/eu-19-Muller-How-To-Break-PDF-Encryption-wp.pdf)
### Unveiling the Underground World of Anti-Cheats
In a world where billion players spend money in games while playing, it was obvious that a parallel market had to come out of it. In this not that new world is related to Cheats, Cheat and Anti-Cheat Developers fight in an endless holy war to see who will be the last standing defending champion. The reality is that none of them have found a way to actually win this war once for all, and they keep playing the cat and mouse game trying to make things harder for the other side.During our research, we analyzed, tested and discovered multiple bypassing techniques against different current market Anti-Cheat technologies such as XignCode3, EasyAntiCheat and BattleEye, to understand and determine the current state of the art of Anti-Cheat software. We use a combination of static and dynamic techniques to document the different techniques to protect and unprotect gaming software. As a result, we put together a tool "AntiCheat-Testing-Framework" that contains a series of bypassing techniques to test them against current market Anti-Cheats software, this will allow attendees and researchers to understand the virtues and weaknesses of them.This talk pretends to catch everyone's attention from new people to experts on the field, starting with a state of the market and interesting cases around the cheating world, and finishing with a deep explanation of each analyzed technique and the results we obtained during the journey.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Noguera-Unveiling-The-Underground-World-Of-Anti-Cheats-2.pdf)
### What the Fuzz
Fuzzers have become one of the most powerful tools at the disposal of offensive security researchers. Yet, outside of a few big companies, they find little use in defensive scenarios. We believe it is time to change this. If you are not fuzzing your code, someone else will be. Various problems currently prevent the widespread adoption of fuzzers as a standard tool in software development. Fuzzing is still hard to use. It requires a significant amount of expertise to adapt fuzzers to new targets. Debugging the fuzzing process often requires understanding the fuzzer and the target application.On our journey to find 0days in targets ranging from applications, libraries, and programming languages to hypervisors and back, we worked on many of these problems. What kind of bugs can current fuzzers find? What kind of code can they test and, where do they stumble? How can we automatize fuzzing tasks? How can we manually guide the fuzzer, where automatization fails? How can we make fuzzers easier to use even by less experienced users? Come to our talk and find out, what state-of-the-art fuzzing technologies have to offer, and what is yet to come. This talk will feature demos, CVEs, and a release, as well as lots of stuff we learned over the last four years of fuzzing research.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Aschermann-What-The-Fuzz.pdf)
### Implementing the Lessons Learned From a Major Cyber Attack
In June 2017, Maersk suffered a major notpetya cyber-attack, this session explains lessons learned and how they are now being applied within Maersk.
### Coffee Service

### Tackling Privilege Escalation with Offense and Defense
Over the past couple of years, various JavaScript APIs have been closely examined by security researchers. They've been audited and fuzzed thoroughly for classic memory corruption issues like buffer overflows, use-after-frees, and type confusions. Nevertheless, there's an interesting class of vulnerabilities that requires manual auditing rather than fuzzing. This class of bugs surfaced back in 2015, and researchers discovered how to exploit it to allow them to bypass built-in security restrictions within the JavaScript engine. Chaining these privilege escalations with undocumented features in Adobe Reader enabled reliable arbitrary code execution.  When one bypass was patched, researchers would discover new and innovative ways to circumvent the restrictions.  To make matters worse, leveraging these JavaScript API restriction bypasses opened the door to numerous memory corruption issues that existed in the less audited security-relevant JavaScript APIs. Even with sandbox protection an untrusted document executing JavaScript code in the privileged context provides avenues for abuse.

Efforts on both the offensive and defensive side of the field were kicked off to combat this class of issues. This presentation will focus on the efforts to combat this class of vulnerabilities which leveraged the exploitation expertise of the researchers along with the knowledge of engineers to implement mitigations against the rising tide of these weaknesses. On the offensive side, researchers thoroughly analyzed the ways in which JavaScript APIs can be abused to elevate execution from unprivileged into privileged context. On the defensive side, engineers leveraged instances of privilege escalations to devise methods that interprets each escalation in the context of general security invariant violations. The security invariants can be described and understood through a formal framework of information flow security properties.  

We will describe some of the surprising discoveries by researchers submitting to the Zero Day Initiative program, which were used to verify the application hardening as it occurred. Over the years, this multi-pronged approach eliminated a large set of vulnerabilities resident in a security model implemented in a JavaScript engine.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Hariri-Tackling-Privilege-Escalation-With-Offense-And-Defense.pdf)
### BitLeaker: Subverting BitLocker with One Vulnerability
Trusted Platform Module (TPM) is a tamper-resistant security module. It has been widely deployed in commercial devices to protect secret data and ensure the trustworthiness of a system. There are two typical types of TPMs, hardware-based discrete TPM (dTPM) and firmware-based TPM (fTPM). Microsoft Windows has used both types of TPMs to protect the Volume Master Key (VMK) of their disk encryption software, BitLocker.BitLocker's TPM feature has not been analyzed in detail. It has hidden behind the TPMs because the TPM protected the VMK of BitLocker with sealing and unsealing functions. Most security researchers concluded the VMK sealed by the TPM was safe. Recent works also showed the only way to extract the VMK from the TPM was physical access like probing the Low Pin Count (LPC) bus or TPM pins. However, we found a novel way that can subvert BitLocker with only the software. So, free lunch for BitLocker is over.In this talk, we introduce a sleep mode vulnerability of the dTPM and fTPM that can subvert BitLocker. We also present our new tool, BitLeaker, that can extract the VMK from the TPMs and decrypt a BitLocker-locked partition without physical access. Last year, we already introduced a dTPM vulnerability, CVE-2018-6622. However, we found another new vulnerability related to the fTPM this year, especially Intel Platform Trust Technology (PTT). The sleep mode vulnerability can subvert not only the fTPM but also the dTPM with system sleep mode, and it can forge Platform Configuration Registers (PCRs). PCRs are core parts of the sealing and unsealing functions to protect the VMK of BitLocker. By exploiting the vulnerability, we extracted the VMK from TPMs and decrypted a BitLocker-locked partition with our custom tool, BitLeaker. Additionally, we present detailed information on BitLocker's VMK protection process related to the TPM and countermeasures.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Han-BitLeaker-Subverting-BitLocker-With-One-Vulnerability.pdf)
### OEM Finder: Hunting Vulnerable OEM IoT Devices at Scale
Nowadays, many consumer IoT vendors employ an OEM production model. They purchase IoT devices from OEM suppliers, then customize and sell those devices under their own brands. While this production model can reduce the device manufacturing costs, it could lead to a high-security risk; generally, when the original device is vulnerable, the OEM device (re-branded device) is also vulnerable. Indeed, the survey conducted by IPVM in 2017 concluded that the vulnerability found in the Hikvision's (OEM supplier's) network camera is propagated to its various OEM devices, which are sold by over 80 vendors.

 Unfortunately, including the above case, we found that the vulnerability databases (e.g., NVD, CVE) do not include and announce vulnerable OEM devices as one of the affected products of the vulnerability. One of the probable causes is that there is still no means to find the OEM devices other than asking the OEM suppliers or inspecting each device manually.

 In order to address this supply chain risk, we developed a new tool called OEM Finder, which can automatically detect OEM device candidates based on the similarity of its appearance between the OEM and original device. To achieve fast, automatic and precise OEM device detection, we adopt an object recognition algorithm (KAZE) with k-NN, and employ graph kernels.  

 Using this tool, we found more than 180 unique vulnerable OEM device candidates from over 50,000 IoT device images, which we had collected from EC websites. Furthermore, we analyzed the latest firmware image of some of these OEM device candidates, which are distributed by the OEM vendor (not OEM suppliers), and confirmed that the devices detected by the tool are indeed an OEM device. Moreover, we also found that the OEM firmware images are still vulnerable. 

 At the end of the talk, we will publish this tool as an online search engine. By uploading a photo of vulnerable IoT devices, this web service can list the OEM device candidates that potentially contain the identical vulnerability. We believe that our web service could help to facilitate finding vulnerable OEM devices and mitigate the security risk.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Nakajima-OEM-Finder-Hunting-Vulnerable-OEM-IoT-Devices-At-Scale-2.pdf)
### New Exploit Technique In Java Deserialization Attack
Java deserialization attack has been proposed around 2015 by Foxglove Security Team. Afterward, another attack surface named Marshalsec Attack has been developed. It allows an attacker to gain Remote Command Execution, which affects a number of applications. It's one of the most crucial security issues in Java security history.Many security researchers and developers mitigate Java deserialization attack by maintaining a deserialization blacklist. Taking Weblogic as an example, by maintaining the blacklist of deserialization constantly to mitigate deserialization attack. So far it is really hard to find gadget chains which can be exploited and gain Remote Command Execution. We found a serious flaw in Java deserialization from another perspective, and we will mainly talk about it in this presentation.We found a new attack vector in the fundamental classes of JDK. Actually, It's really prevalent in Java applications, which involves most of the request library, such as URLClassLoader, official HTTP request class, Apache HTTP client and so on. Combining this attack vector, we found a lot of new gadget chains that can be utilized, according to these gadget chains and the attack vector, we can bypass all of the blacklists and gain Remote Code Execution.In our depth research, we analyzed more than 10000+ Java third-party libraries and found many cases which can be exploited in real-world attack scenarios. In this talk, we will bat around the principle and exploit technique of these vulnerabilities. Also, we will present how to pwn target server by our new exploit technique. It can not only improve the effect of java deserialization vulnerability but also enhance other Java security issues impact, and we will discuss profound impacts of the attack vector in the java security field.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Zhang-New-Exploit-Technique-In-Java-Deserialization-Attack.pdf)
### Lunch Break

### Alexa, Hack My Server(less) Please
When adopting serverless technology, we eliminate the need to manage a server for our application. By doing so, we also pass some of the security threats to the cloud provider. We do not need to care about OS patching and configuration any more. It's all in the safe hands of the service providers. However, Serverless function still executes code. If written poorly, it can lead into a cloud disaster. One particular example is the injection attacks. Yes, injection attacks nothing new. But, what happens when there is no longer a perimeter? In this talk, I will examine the Serverless #1 risk: Event injection and will demonstrate injection attacks form multiple event types, such as emails, logs, files and even through Alexa.
- [slide](https://i.blackhat.com/eu-19/Thursday/eu-19-Melamed-Alexa-Hack-My-Server-less-Please.pdf)
### Fatal Fury on ESP32: Time to Release Hardware Exploits
Released on January 1st 2016, the ESP32, the System-on-Chip (SoC) from Espressif Systems, becomes quickly popular among the IoT industry and electronic hobbyists, due to its wireless connectivity, a low-power consumption and a free development framework supporting plenty of functions. Espressif is supporting a 12-years-longevity commitment for ESP32, and has already achieved the 100 Millions Target of IoT chip Shipments in January 2019 [1].This SoC, based on Xtensa LX6 dual-core, contains built-in security features such as:- Crypto-Hardware accelerator. The HW crypto accelerators are nowadays used to speed up cryptographic primitives like AES, SHA and even RSA, which will be used by crypto library like ARM MbedTLS [2].- Secure Boot. The Secure boot is the guardian of the firmware authenticity and integrity stored into the Flash memory. - Flash encryption. The Flash encryption is used to protect the firmware confidentiality, for example to avoid the loss of IP or to a readout of persistent and sensitive data like Wi-FI credentials in IoT devices [3].- One Time Programmable (OTP) memory. The OTP memory, based on eFuses, is considered as a Root-of-Trust to store the security configuration and the secret AES-256 keys, dedicated to secure boot process and Flash encryption. This memory is R/W protected (obviously).This talk presents, in a methodical way, how to defeat one by one the previously listed security features, having physical access to the device and using low-cost hardware techniques such as voltage glitching, analog side-channels, micro-soldering and reverse (of course). To the best of my knowledge, Built-in ESP32 security features such as Secure boot and Flash Encryption were never broken until now. Defeating these protections on a popular platform such as ESP32 should be considered as a serious threat by all the developers using the ESP32 as a main CPU platform or even as a WIFI/bluetooth peripheral, in their final products. Some discovered vulnerabilities cannot be patched without silicon redesign, leading to a lot of vulnerable devices on the field for the coming years.[1] - https://www.espressif.com/en/products/hardware[2] - https://os.mbed.com/docs/mbed-os/v5.10/porting/hardware-accelerated-crypto.html[3] - https://limitedresults.com/2019/01/pwn-the-lifx-mini-white/
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-LimitedResults-Fatal-Fury-On-ESP32-Time-To-Release-Hardware-Exploits.pdf)
### Site Isolation: Confining Untrustworthy Code in the Web Browser
In the late 2000s, web browsers moved from single-process to multi-process architectures, introducing a sandbox boundary between untrustworthy code from the web and local resources. While effective at the time, the security landscape has changed and a stronger architecture is now needed.

In this talk, we will cover our deployment of the Site Isolation architecture to Chrome users.  This pushes the browser security model forward, mitigating entire classes of attacks: from same-process Spectre exploits to UXSS to arbitrary code execution in the renderer sandbox.  We will discuss how the browser's architecture has changed, what security properties it offers, what limitations still exist, and how we preserved compatibility and performance to scale it to all Chrome desktop users.  Finally, we will give examples of new types of Site Isolation bypass bugs that fall into Chrome's Vulnerability Rewards Program, for those motivated to help us make this defense stronger.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Oskov-Site-Isolation-Confining-Untrustworthy-Code-In-The-Web-Browser-2.pdf)
### BlueMaster: Bypassing and Fixing Bluetooth-based Proximity Authentication
Bluetooth enabled devices can indirectly check the proximity of other connected devices, and this proximity check can be used as an authentication means. Thanks to the widespread use of Bluetooth, popular software vendors such as Google and Microsoft offer this device proximity authentication method in their operating systems, namely, Android and Windows 10. On one hand, Google's Android supports a feature called Android Smart Lock, which allows a user to register 'trusted' Bluetooth devices, and then utilize the presence of such trusted devices as an alternative to passcode. On the other hand, Microsoft Windows uses this proof-of-device-proximity in a reverse way. Windows 10 introduces Dynamic Lock, which automatically 'locks' the device if any of the paired Smartphone moves away, to block access to the computer while the user is unattended.In this talk, we present the security pitfalls of Bluetooth-based proximity authentication. We analyzed implementations of Android Smart Lock and Windows Dynamic Lock and demonstrated new attacks on these implementations. Based on our analysis, we discovered three new attacks that allow attackers to bypass device proximity authentication. From Android Smart Lock, attackers may bypass a security check that prevents a basic MAC spoofing attack. From Windows Dynamic Lock, attackers may alter the MAC address and device class to spoof a paired smartphone, and it is also vulnerable to a proximity spoofing attack.Our analysis result shows that the vulnerabilities are originated from accepting untrusted data from Bluetooth for authentication. Additionally, regarding the proximity checking, it turned out that none of both is secure; Android ignores device proximity, and Windows is susceptible to signal amplification attack.Finally, we discuss potential countermeasures and inherent weaknesses of proximity checking in Bluetooth, as well as how to analyze the security of the Bluetooth-based device and proximity authentication method. Our countermeasure includes several ideas on how to accept only trusted data from Bluetooth for authentication methods. Furthermore, we will release a detection tool for the problems we found.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Jung-BlueMaster-Bypassing-And-Fixing-Bluetooth-Based-Proximity-Authentication.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Thursday/eu-19-Jung-BlueMaster-Bypassing-And-Fixing-Bluetooth-Based-Proximity-Authentication-wp.pdf)
### Arsenal Reception

### Coffee Service

### Trust in Apple&#39;s Secret Garden: Exploring &#38; Reversing Apple&#39;s Continuity Protocol
Apple devices are known for "it works", after you unbox it and login with your Apple ID, and it would be able to integrate other devices from Apple.By using protocols like AirDrop, iMessage which falls under the umbrella of "Continuity," devices can seamlessly share messages, browser tabs, clipboards and wireless hotspots without much hassle of setting it up. However, during our daily usage of said protocols, we barely to think about privacy and security implications behind these protocols, and will be assuming that Apple protects our privacy at all times. However, as these are proprietary protocols, it's not validated by any 3rd party and in some cases, these claims regarding security and privacy are not true.Since Continuity is based on BLE, some actions which required using it as bootstrapping and switching to another protocols would result in MAC address de-anonymization, and by the way the device announces its presence to nearby brethren, it results in privacy leaks which an adversary can learn its metadata such as screen usage, battery levels, and even OS fingerprinting.As another in-progress target of this research is to port Continuity to other platforms, its protocol details will be discussed openly to the world for the first time.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Yen-Trust-In-Apples-Secret-Garden-Exploring-Reversing-Apples-Continuity-Protocol-3.pdf)
### Decisions and Revisions - The Ever Evolving Face of the Black Hat NOC
This session is your chance to get up close and personal with the Black Hat NOC. We'll walk you through the process of deciding what equipment and services we deploy on the Black Hat network, and our reasoning around those decisions. We'll also discuss the changes we make when deploying and securing a network in the U.S., Europe, and Asia, and will share some of the behavioral differences we see in the attendees of those shows, both good and bad. And of course, there will be stories and stats! We'll provide a full debrief of the activity we experienced this year, what has changed since past shows, and what that means for our industry as whole.
### Practical Side-Channel Attacks Against WPA-TKIP
Wireless networks and their security protocols keep evolving due to increased performance and reliability demands. For instance, recently the Wi-Fi Alliance released WPA3, which offers better security guarantees (e.g., longer keys). In light of this, one would assume that legacy protocols such as WPA-TKIP are no longer widely used in modern Wi-Fi networks. Unfortunately, our wardriving efforts revealed that 44.81% of encrypted Wi-Fi networks still support and use WPA-TKIP. These wardrives spanned cities in the United States, Germany, and Belgium, and high usage of WPA-TKIP was observed in all of them. Motivated by this, we systematically analyzed the security of WPA-TKIP implementations.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Schepers-Practical-Side-Channel-Attacks-Against-WPA-TKIP-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Thursday/eu-19-Schepers-Practical-Side-Channel-Attacks-Against-WPA-TKIP-wp.pdf)
### Bypassing KPTI Using the Speculative Behavior of the SWAPGS Instruction
Speculative-execution based attacks and side-channels are more and more common as disclosures continue to increase scrutiny by researchers in this field. In this talk, we demonstrate a new type of side-channel attack based on speculative execution of the SWAPGS instruction inside the OS kernel. This attack is capable of circumventing all existing protective measures, such as CPU microcode patches or kernel address space isolation (KVA shadowing/KPTI). We practically demonstrate this by showing how the speculative execution of the SWAPGS instruction may allow an attacker to leak portions of the kernel memory, by employing a variant of Spectre V1. During the talk, we will also detail some other minor discoveries related to speculative execution, mainly how some segment registers are handled.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Lutas-Bypassing-KPTI-Using-The-Speculative-Behavior-Of-The-SWAPGS-Instruction-2.pdf)
- [whitepaper](http://i.blackhat.com/eu-19/Thursday/eu-19-Lutas-Bypassing-KPTI-Using-The-Speculative-Behavior-Of-The-SWAPGS-Instruction-wp.pdf)
### Break

### Breaking Bootloaders on the Cheap
One of the challenges in securing embedded devices is to protect the flash memory storing code, data, and cryptographic secrets against malicious read/write access. Therefore, most microcontroller vendors decided to implement code read protection mechanisms (usually controlled by some security bits or fuses) in order to prevent such attacks.Most modern microcontrollers include a bootloader (stored in ROM) that allows for in-circuit programming via USB, UART, or another link. The bootloader is also responsible for enforcing potentially configured readout protections. So far, attacks against embedded bootloaders were based on hardware attacks, e.g. using voltage glitching or UV light. Logical vulnerabilities (e.g. buffer overflows) in the bootloader code have received less attention.For this presentation, we reverse-engineered and analysed the bootloaders of three widely used microcontrollers (NXP LPC1343, ST STM32F4, and ST STM8) in order to assess if the readout protection can be overcome with software-based attacks.Our analysis shows that the bootloader of the LPC1343 (and other chips from the same family) contains a critical vulnerability in the "Write to RAM" command. While the command prevents writing to bootloader RAM, without the Memory Management Unit, it does not protect the stack (located at the other end of memory). This allows an attacker to break code readout protection level 1 by overwriting return addresses on the stack and chaining gadgets of code as in Return-Oriented Programming. The attack can be carried out with any cheap serial-to-USB converter.We responsibly disclosed this to NXP, and they acknowledged the issue. Although NXP had cautioned users about limitations of using CRP level 1, they updated their developer guidance and now recommend to set CRP level 2 or 3, where this exploit is not possible.While we did not find similar issues in the code of the STM32 and STM8 bootloaders, we point out that analysis on the assembly level can be useful in developing other attacks, e.g. for pinpointing the correct locations for voltage glitching.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Temeiza-Breaking-Bootloaders-On-The-Cheap-2.pdf)
### Simple Spyware: Androids Invisible Foreground Services and How to (Ab)use Them
With the releases of Android Oreo and Pie, Google introduced some background execution limits for Android apps [1],[2]. In order to save battery life and prevent sensor access, apps were restricted in how they were capable of executing background services. Apps were no longer allowed to run background services in idle state and therefore preventing apps from using the devices resources like the camera. These limitations however, would not affect so-called foreground services, because foreground services show a permanently visible notification to the user and could therefore be stopped by the user at any time. Our research found out that a flaw in the API exists, which allows to start invisible foreground services, making the introduced limitations useless. Foreground services do not show any visual notification when the execution time of the service is shorter than five seconds. Using this and combining it with another flaw in Androids Job Scheduler API allows to constantly execute arbitrary tasks from a background context. This allows apps to use the resources of the device, even when the app is closed, or the device is in stand-by. Furthermore, we can prove that these flaws can be abused for constantly spying on the user and allowing malware developers to create spyware without the need of complicated exploitation. This simple to implement spyware shows that Androids permission model can't prevent an excessive use of permissions and that the limitations do not prevent the collection of the user's sensitive data. In order to prevent such attacks, it would be necessary to constantly monitor the apps permission usage or to revoke the permissions after every use. Such prevention mechanisms already exist but aren't widely used, which sets the users privacy and security at risk. We will show what users can do in order to guard themselves against such spyware attacks. Furthermore, we will introduce our solution ideas to detect such spyware on Android.[1]: Googles Android Oreo Release Notes: https://developer.android.com/about/versions/oreo/background[2]: Googles Android Pie Release Notes: https://developer.android.com/about/versions/pie/android-9.0-changes-all
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Sutter-Simple-Spyware-Androids-Invisible-Foreground-Services-And-How-To-Abuse-Them-2.pdf)
### Thinking Outside the JIT Compiler: Understanding and Bypassing StructureID Randomization with Generic and Old-School Methods
In the last two years, lots of JIT compiler bugs have been found in the major browsers. For Safari, the most common way of exploiting a JIT bug in the JavaScriptCore engine is to construct the addrOf/fakeObj primitives[1]. And with those primitives, the arbitrary Read/Write ability can be easily gained. Specifically, it's indispensable that an attacker needs a valid Structure ID to fake a JSCELL during exploitation. So the well-known technique - spraying the Structures to predict the IDs is introduced in 2016[2]. In the early of this year, WebKit introduces the StructureID Randomization mitigation[3]. And recently it has been enabled in the latest official release of *OS(i.e. iOS 12.4). So predicting the Structure ID by spraying can't work anymore.In this talk, we will detail our new and generic methods to bypass StructureID Randomization mitigation, which allows an attacker to construct the addrOf/fakeObj primitives and gain the arbitrary Read/Write ability smoothly. Unlike the bug-specific and JIT compiler related way to bypass this mitigation[4], our generic and old-school methods have not been thoroughly presented in any previous talks. We believe our talk will inspire the design of more effective mitigations.References:[1] https://saelo.github.io/presentations/blackhat_us_18_attacking_client_side_jit_compilers.pdf[2] http://www.phrack.org/papers/attacking_javascript_engines.html[3] https://github.com/WebKit/webkit/commit/f19aec9c6319a216f336aacd1f5cc75abba49cdf[4] http://iokit.racing/jsctales.pdf
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Wang-Thinking-Outside-The-JIT-Compiler-Understanding-And-Bypassing-StructureID-Randomization-With-Generic-And-Old-School-Methods.pdf)
### Inside Out - The Cloud has Never been so Close
The public cloud infrastructure adds new management layer and security challenges that need to be well understood and secured. The fact that cloud provider application programming interfaces (API) are accessible through the internet has opened a new window for adversaries to take advantage and gain highly privileged access to cloud critical assets. Traditional defense mechanism mostly focuses on network, application and operating system defense. The use of public APIs introduces a new attack surface, one that traditional defenses cannot protect.Credential theft is a well-known attack vector used by many adversaries. It is so successful because organizations are struggling to follow the principle of least privilege. The persons who are in charge of cloud resources usually are the DevOps, Development and IT teams who need to manage those resources. Access to APIs performed by using different software development kit (SDK) and dedicated command line tools. Once those accounts are compromised, gaining access to high-value resources is one API call away.In this talk, we present an alternative new approach for attacking cloud infrastructure. We use graphs to build and illustrate the relationships between different resources, identities, and policies. After mapping all the relationships, we show how adversaries can easily abuse existing features to escalate privileges and get to high-value resources.
- [slide](http://i.blackhat.com/eu-19/Thursday/eu-19-Gofman-Inside-Out-The-Cloud-Have-Never-Been-So-Close-2.pdf)
- [source_code](https://protect-us.mimecast.com/s/b96XCzpBnGHMk4Ovnf4rEjQ?domain=github.com)
### Break

### Locknote: Conclusions and Key Takeaways from Black Hat Europe 2019
At the close of this year's conference, join Black Hat Founder Jeff Moss and members of the esteemed Black Hat Review Board for an insightful conversation on the most pressing issues facing the InfoSec community. This Locknote will feature a candid discussion on the key takeaways coming out of Black Hat Europe and how these trends will impact future InfoSec strategies.